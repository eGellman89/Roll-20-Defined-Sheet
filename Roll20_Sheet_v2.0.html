<!-- <editor-fold desc="Roll Template" -->
<rolltemplate class="sheet-rolltemplate-custom">
 <div class="sheet-container sheet-color-{{color}}">
  <div class="sheet-header">
   {{#title}}
   <div class="sheet-title">{{title}}</div>
   {{/title}}
   {{#subtitle}}
   <div class="sheet-subtitle">{{subtitle}}</div>
   {{/subtitle}}
  </div>
  <div class="sheet-content">
   {{#allprops() title subtitle desc color}}
   <div class="sheet-key">{{key}}</div>
   <div class="sheet-value">{{value}}</div>
   {{/allprops() title subtitle desc color}}
   {{#desc}}
   <div class="sheet-desc">{{desc}}</div>
   {{/desc}}
  </div>
 </div>
</rolltemplate>
<!-- </editor-fold -->

<!-- <editor-fold desc="ButtonBar"> -->
<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab"  value="main"/>
<div style="text-align: center; width: 800px;" class="SAbutton">
 <button type="action" name="act_main">Main</button>
 <button type="action" name="act_definitions">Definitions & Traits</button>
 <button type="action" name="act_abilities">Abillities</button>
 <button type="action" name="act_spells">Spells</button>
 <button type="action" name="act_skills">Skills</button>
 <button type="action" name="act_gear">Armor/Weapons</button>
 <button type="action" name="act_accessories">Accessories</button>
 <button type="action" name="act_inventory">Inventory</button>
</div>

<!-- </editor-fold> -->

<!-- <editor-fold desc="Main Tab"> -->
<div class="sheet-main">
 <div class="character-info-block main-full">
  <div class="column-header grcsa">Character Information</div>
  <div id="player-name">
   <div>Character Name</div>
   <div><input class="flex-input" type="text" name="attr_charname"/></div>
   <div>Player Name</div>
   <div><input class="flex-input" type="text" name="attr_PlayerName"/></div>
  </div>
  <div id="age-and-height">
   <div>Age</div>
   <div><input class="flex-input" type="number" name="attr_characterage"/></div>
   <div>Height</div>
   <div><input class="flex-input" type="text" name="attr_characterheight"/></div>
  </div>
  <div id="weight-and-gender">
   <div>Weight</div>
   <div><input class="flex-input" type="text" name="attr_characterweight" /></div>
   <div>Gender</div>
   <div><input class="flex-input" type="text" name="attr_charactergender"/></div>
  </div>
  <div id="species-name">
   <div>Species</div>
   <div><input class="flex-input" type="text" name="attr_species"/></div>
   <div>Speed</div>
   <div><input class="flex-input" type="text" name="attr_basespeed"/></div>
  </div>
  <div id="more-speed">
   <div>Speed (Fly)</div>
   <div><input class="flex-input" type="text" name="attr_flyspeed" placeholder="#(Manuverability)"/></div>
   <div>Speed (Swim)</div>
   <div><input class="flex-input" type="text" name="attr_swimspeed"/></div>
  </div>
  <div id="religion-name">
   <div>Religion</div>
   <div><input class="flex-input" type="text" name="attr_Religion"/></div>
   <div>Sanctity</div>
   <div><input class="flex-input" type="text" name="attr_Sanctity"/></div>
  </div>
  <div id="hd-and-size">
   <div>HD</div>
   <div><input class="flex-input" type="number" name="attr_HD" /></div>
   <div>Size Category</div>
   <div class="DataBox">
    <select type="text" name="attr_size" id="SizeCategory">
    <option value="Sub Tiny">Sub Tiny</option>
    <option value="Tiny">Tiny</option>
    <option value="Very Small">Very Small</option>
    <option value="Small">Small</option>
    <option selected="selected" value="Medium">Medium</option>
    <option value="Large">Large</option>
    <option value="Very Large">Very Large</option>
    <option value="Gargantuan">Gargantuan</option>
    <option value="Super Gargantuan">Super Gargantuan</option>
   </select>
   </div>
  </div>
 </div>
  <div class="main-left">
   <div class="attribute-block">
  <div class="column-header grcsa">Attributes</div>
  <div id="name">
   <div class="titleblock"> </div>
   <div class="titleblock">Strength</div>
   <div class="titleblock">Dexterity</div>
   <div class="titleblock">Constitution</div>
   <div class="titleblock">Intelligence</div>
   <div class="titleblock">Wisdom</div>
   <div class="titleblock">Charisma</div>
  </div>
  <div id="base">
   <div class="titleblock">Base</div>
   <div><input type="number" name="attr_strength"/></div>
   <div><input type="number" name="attr_dexterity"/></div>
   <div><input type="number" name="attr_constitution"/></div>
   <div><input type="number" name="attr_intelligence"/></div>
   <div><input type="number" name="attr_wisdom"/></div>
   <div><input type="number" name="attr_charisma"/></div>
  </div>
  <div id="enhancement">
   <div class="titleblock">Magic</div>
   <div><input type="number" name="attr_StrEnch"/></div>
   <div><input type="number" name="attr_DexEnch"/></div>
   <div><input type="number" name="attr_ConEnch"/></div>
   <div><input type="number" name="attr_IntEnch"/></div>
   <div><input type="number" name="attr_WisEnch"/></div>
   <div><input type="number" name="attr_ChaEnch"/></div>
  </div>
  <div id="bonus">
   <div class="titleblock">Bonus</div>
   <div><input type="number" name="attr_StrBonus"/></div>
   <div><input type="number" name="attr_DexBonus"/></div>
   <div><input type="number" name="attr_ConBonus"/></div>
   <div><input type="number" name="attr_IntBonus"/></div>
   <div><input type="number" name="attr_WisBonus"/></div>
   <div><input type="number" name="attr_ChaBonus"/></div>
  </div>
  <div id="penalty">
   <div class="titleblock">Penalty</div>
   <div><input type="number" name="attr_StrPen"/></div>
   <div><input type="number" name="attr_DexPen"/></div>
   <div><input type="number" name="attr_ConPen"/></div>
   <div><input type="number" name="attr_IntPen"/></div>
   <div><input type="number" name="attr_WisPen"/></div>
   <div><input type="number" name="attr_ChaPen"/></div>
  </div>
  <div id="total">
   <div class="titleblock">Total</div>
   <div><input type="number" name="attr_StrTotal" readonly="true"/></div>
   <div><input type="number" name="attr_DexTotal" readonly="true"/></div>
   <div><input type="number" name="attr_ConTotal" readonly="true"/></div>
   <div><input type="number" name="attr_IntTotal" readonly="true"/></div>
   <div><input type="number" name="attr_WisTotal" readonly="true"/></div>
   <div><input type="number" name="attr_ChaTotal" readonly="true"/></div>
  </div>
  <div id="modifier">
   <div class="titleblock">Modifier</div>
    <div><input type="number" name="attr_strmod" readonly="true"/></div>
    <div><input type="number" name="attr_dexmod" readonly="true"/></div>
    <div><input type="number" name="attr_conmod" readonly="true"/></div>
    <div><input type="number" name="attr_intmod" readonly="true"/></div>
    <div><input type="number" name="attr_wismod" readonly="true"/></div>
    <div><input type="number" name="attr_chamod" readonly="true"/></div>
   </div>
  <div id="check">
   <div class="titleblock">Roll</div>
   <div>
    <button title="Strength Check"
            type="roll"
            value="&{template:custom}{{title=Strength Check}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{strmod}]]}}"
            name="roll_Strength-Check"></button>
   </div>
   <div>
    <button title="Dexterity Check"
            type="roll"
            value="&{template:custom}{{title=Dexterity Check}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{dexmod}]]}}"
            name="roll_Dexterity-check"></button>
   </div>
   <div>
    <button title="Constitution Check"
            type="roll"
            value="&{template:custom}{{title=Constitution Check}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{conmod}]]}}"
            name="roll_Constitution-check"></button>
   </div>
   <div>
    <button title="Intelligence Check"
            type="roll"
            value="&{template:custom}{{title=Intelligence Check}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{intmod}]]}}"
            name="roll_Intelligence-check"></button>
   </div>
   <div>
    <button title="Wisdom Check"
            type="roll"
            value="&{template:custom}{{title=Wisdom Check}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{wismod}]]}}"
            name="roll_Wisdom-check"></button>
   </div>
   <div>
    <button title="Charisma Check"
            type="roll"
            value="&{template:custom}{{title=Charisma Check}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{chamod}]]}}"
            name="roll_Charisma-check"></button>
   </div>
  </div>
 </div>
   <div class="saving-throw-block">
    <div class="column-header grcsa">Saving Throws</div>
    <div id="save-name">
     <div class="titleblock">Fortitude</div>
     <div class="titleblock">
      <select type="text" name="attr_FortBaseStr" id="FortBase">
       <option value="Low">Low</option>
       <option value="High">High</option>
      </select>
     </div>
     <div class="titleblock">Reflex</div>
     <div class="titleblock">
      <select type="text" name="attr_RefBaseStr" id="ReflexBase">
       <option value="Low">Low</option>
       <option value="High">High</option>
      </select>
     </div>
     <div class="titleblock">Will</div>
     <div class="titleblock">
      <select type="text" name="attr_WilBaseStr" id="WillBase">
       <option value="Low">Low</option>
       <option value="High">High</option>
      </select>
     </div>
    </div>
    <div id="save-total">
     <div><b>Total</b></div>
     <div><input type="number" readonly name="attr_FortTotal"/></div>
     <div><b>Total</b></div>
     <div><input type="number" readonly name="attr_RefTotal"/></div>
     <div><b>Total</b></div>
     <div><input type="number" readonly name="attr_WilTotal"/></div>
    </div>
    <div id="save-base">
     <div>Base</div>
     <div><input type="number" name="attr_FortBaseNum" readonly="true"/></div>
     <div>Base</div>
     <div><input type="number" name="attr_RefBaseNum" readonly="true"/></div>
     <div>Base</div>
     <div><input type="number" name="attr_WilBaseNum" readonly="true"/></div>
    </div>
    <div id="save-key">
     <div>Con</div>
     <div><input type="number" name="attr_conmod" readonly="true"/></div>
     <div>Dex</div>
     <div><input type="number" name="attr_dexmod" readonly="true"/></div>
     <div>Wis</div>
     <div><input type="number" name="attr_wismod" readonly="true"/></div>
    </div>
    <div id="save-magic">
     <div>Magic</div>
     <div><input type="number" name="attr_FortMagic"/></div>
     <div>Magic</div>
     <div><input type="number" name="attr_RefMagic"/></div>
     <div>Magic</div>
     <div><input type="number" name="attr_WilMagic"/></div>
    </div>
    <div id="save-misc">
     <div>Misc.</div>
     <div><input type="number" name="attr_FortMiscNum"/></div>
     <div>Misc.</div>
     <div><input type="number" name="attr_RefMiscNum"/></div>
     <div>Misc.</div>
     <div><input type="number" name="attr_WilMiscNum"/></div>
    </div>
    <div id="save-temp">
     <div>Temp</div>
     <div><input type="number" name="attr_FortTempNum"/></div>
     <div>Temp</div>
     <div><input type="number" name="attr_RefTempNum"/></div>
     <div>Temp</div>
     <div><input type="number" name="attr_WilTempNum"/></div>
    </div>
    <div id="save-check">
     <div class="titleblock">Save</div>
     <div class="titleblock">
      <button title="Fortitude Save"
              type="roll"
              value="&{template:custom}{{title=Fortitude Save}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{FortTotal}]]}}"
              name="roll_Fortitude-save"></button>
     </div>
     <div class="titleblock">Save</div>
     <div class="titleblock">
      <button title="Reflex Save"
              type="roll"
              value="&{template:custom}{{title=Reflex Save}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{RefTotal}]]}}"
              name="roll_Reflex-save"></button>
     </div>
     <div class="titleblock">Save</div>
     <div class="titleblock">
      <button title="Will Save"
              type="roll"
              value="&{template:custom}{{title=Will Save}}{{subtitle=@{Charname}}}{{Result:= [[1d20+@{WilTotal}]]}}"
              name="roll_Will-save"></button>
     </div>
    </div>
   </div>
   <div class="column-header">Advanced Combat</div>
   <div class="ggrid titleblock">
    <div class="grc1">
     <div>&nbsp;</div>
     <div>Magic Touch Attack:</div>
     <div>Martial Touch Attack:</div>
     <div>Opposed (Trip):</div>
     <div>Opposed (Shove):</div>
     <div>Opposed (Trample):</div>
     <div>Grapple</div>
    </div>
    <div class="grc2">
     <div>Total</div>
     <div><input type="number" readonly="true" name="attr_MagicTouchAttack"/></div>
     <div><input type="number" readonly="true" name="attr_MartialTouchAttack"/></div>
     <div><input type="number" readonly="true" name="attr_TripOpposed"/></div>
     <div><input type="number" readonly="true" name="attr_ShoveOpposed"/></div>
     <div><input type="number" readonly="true" name="attr_TrampleOpposed"/></div>
     <div><input type="number" readonly="true" name="attr_Grapple"/></div>
    </div>
    <div class="grc3">
     <div>Feat</div>
     <div><input type="number" name="attr_MagicTouchAttackFeat" /></div>
     <div><input type="number" name="attr_MartialTouchAttackFeat" /></div>
     <div><input type="number" name="attr_TripOpposedFeat" /></div>
     <div><input type="number" name="attr_ShoveOpposedFeat" /></div>
     <div><input type="number" name="attr_TrampleOpposedFeat" /></div>
     <div><input type="number" name="attr_GrappleFeat"/></div>
    </div>
    <div class="grc4">
     <div>Misc.</div>
     <div><input type="number" name="attr_MagicTouchAttackMisc" /></div>
     <div><input type="number" name="attr_MartialTouchAttackMisc" /></div>
     <div><input type="number" name="attr_TripOpposedMisc" /></div>
     <div><input type="number" name="attr_ShoveOpposedMisc" /></div>
     <div><input type="number" name="attr_TrampleOpposedMisc" /></div>
     <div><input type="number" name="attr_GrappleMisc"/></div>
    </div>
    <div class="grc5">
     <div>Temp</div>
     <div><input type="number" name="attr_MagicTouchAttackTemp" /></div>
     <div><input type="number" name="attr_MartialTouchAttackTemp" /></div>
     <div><input type="number" name="attr_TripOpposedTemp" /></div>
     <div><input type="number" name="attr_ShoveOpposedTemp" /></div>
     <div><input type="number" name="attr_TrampleOpposedTemp" /></div>
     <div><input type="number" name="attr_GrappleTemp"/></div>
    </div>
    <div class="grc6">
     <div>Roll</div>
     <div>
      <button class="button"
              title="MagicTouchAttack"
              type="roll"
              value="&{template:custom}{{title=Magic Touch Attack}}{{subtitle= @{charname}'s touch spell}}{{Result:=[[1d20+@{MagicTouchAttack}]]}}"
              name="roll_MagicTouchAttackR"></button>
     </div>
     <div>
      <button class="button"
              title="MartialTouchAttack"
              type="roll"
              value="&{template:custom}{{title=Martial Touch Attack}}{{subtitle= @{charname}'s touch attack}}{{Result:=[[1d20+@{MartialTouchAttack}]]}}"
              name="roll_MartialTouchAttackR"></button>
     </div>
     <div>
      <button class="button"
              title="Opposed Trip"
              type="roll"
              value="&{template:custom}{{title=oppose strength (Trip)}}{{subtitle= @{charname}'s opposing strength}}{{Result:=[[1d20+@{TripOpposed}]]}}"
              name="roll_TripOpposedR"></button>
     </div>
     <div>
      <button class="button"
              title="Opposed Shove"
              type="roll"
              value="&{template:custom}{{title=oppose strength (Shove)}}{{subtitle= @{charname}'s opposing strength}}{{Result:=[[1d20+@{ShoveOpposed}]]}}"
              name="roll_ShoveOpposedR"></button>
     </div>
     <div>
      <button class="button"
              title="Opposed Trample"
              type="roll"
              value="&{template:custom}{{title=oppose strength (Trample)}}{{subtitle= @{charname}'s opposing strength}}{{Result:=[[1d20+@{TrampleOpposed}]]}}"
              name="roll_opposed-trampleR"></button>
     </div>
     <div>
      <button class="button"
              title="Opposed Grapple"
              type="roll"
              value="&{template:custom}{{title=Opposed Grapple}}{{subtitle= @{charname} }}{{Result=[[1d20+@{Grapple}]]}}"
              name="roll_opposed-grappleR"></button>
     </div>
    </div>
   </div> <!--Advanced Combat Grid-->
  </div>
  <div class="main-right">
   <div class="hp-armor-block">
    <div class="grc1">
     <div class="column-header">Hit Points</div>
     <div class="hp-column">
      <div id="hp-names">
       <div>Current HP:</div>
       <div>Max HP:</div>
       <div>Constitution:</div>
       <div>Progression:</div>
       <div>Misc. HP:</div>
       <div>Rolled HP:</div>
      </div>
      <div id="hp-inputs">
       <div><input type="number" name="attr_hp"/></td></div>
       <div><input type="number" readonly="true" name="attr_hp_max"/></div>
       <div><input type="number" readonly="true" name="attr_ConHP"/></div>
       <div><input type="number" readonly="true" name="attr_ProgHP"/></div>
       <div><input type="number" name="attr_MiscHP"/></div>
       <div><input type="number" name="attr_RollHP"/></div>
      </div>
     </div>
     <div class="column-header">Initiative
      <button class="button tokenaction"
              title="Initiative"
              type="roll"
              value="&{template:custom}{{title=Initiative}}{{subtitle=@{charname}}}{{Result:= [[1d20+@{InitTotal}+(@{InitTotal}/100)+([[d10-1]]/1000)&{tracker}]]}}"
              name="roll_00-Inintiative"></button>
     </div>
     <div class="ggrid">
      <div class="grc1">
       <div style="color: #FFFFFF">Total</div>
       <div><input type="number" readonly="true" name="attr_InitTotal"/></div>
     </div>
      <div class="grc2">
       <div>&nbsp;</div>
       <div class="titleblock">=</div>
      </div>
      <div class="grc3">
       <div style="color: #FFFFFF">Dex</div>
       <div class="titleblock"><input type="number" name="attr_dexmod" readonly="true"/></div>
      </div>
      <div class="grc4">
       <div>&nbsp;</div>
       <div class="titleblock">+</div>
      </div>
      <div class="grc5">
       <div style="color: #FFFFFF">Misc</div>
       <div><input type="number" name="attr_InitBonus"/></div>
      </div>
    </div> <!-- Initiative Boxes -->
     <div class="column-header">Wound and Base Attack</div>
     <div class="ggrid"> <!--Wound and Base Attack Grid-->
      <div class="grc1">
       <div class="titleblock">Wound DC</div>
       <div><input type="number" name="attr_WoundDC" readonly/></div>
      </div>
      <div class="grc2">
       <div class="titleblock">Base Attack</div>
       <div><input type="number" name="attr_BAB" readonly/></div>
      </div>
     </div>
    </div>
    <div class="grc2">
     <div class="column-header">Armor Class</div>
     <div class="ac-column">
      <div id="ac-names">
       <div>Total AC:</div>
       <div>Touch AC:</div>
       <div>Flat-Footed AC:</div>
       <div>Armor:</div>
       <div>Shield:</div>
       <div>Natural:</div>
       <div>Deflection:</div>
       <div>Parry:</div>
       <div>Dodge:</div>
       <div>Insight:</div>
       <div>Misc:</div>
      </div>
      <div id="ac-inputs">
       <div><input type="number" readonly="true" name="attr_TotalAC"/></div>
       <div><input type="number" readonly="true" name="attr_TouchAC"/></div>
       <div><input type="number" readonly="true" name="attr_FlatFAC"/></div>
       <div><input type="number" readonly="true" name="attr_ArmorBonus"/></div>
       <div><input type="number" readonly="true" name="attr_Shield"/></div>
       <div><input type="number" name="attr_NaturalAC"></div>
       <div><input type="number" name="attr_Deflection"/></div>
       <div><input type="number" name="attr_ParryAC"/></div>
       <div><input type="number" name="attr_DodgeAC"/></div>
       <div><input type="number" name="attr_InsightAC"/></div>
       <div><input type="number" name="attr_MiscAC"/></div>
      </div>
     </div>
    </div>
  </div>
   <div class="column-header grcsa">Notes</div>
   <div>
    <textarea name="attr_Main-Notes" placeholder="Pertinent information, notes, and bonuses..."/>
   </div>
  </div>
</div>
<!--</editor-fold>-->

<!--<editor-fold desc="Spells"-->
<div class="sheet-spells">
 <div class="gridarea">
  <div class="titleblock">
   <h3 style="color:white">Spell Casting</h3>
   Primary Mental Attribute(PMA): <select name="attr_PMA" value="" class="fixed-select">
   <option value="@{strmod}">Str</option>
   <option value="@{dexmod}">Dex</option>
   <option value="@{wismod}">Wis</option>
   <option value="@{intmod}">Int</option>
   <option value="@{chamod}">Cha</option>
  </select><br>
   Caster Level: <input type="number" name="attr_cl" readonly/>
   Spell Penetration Bonus:<input type="number" name="attr_spellpenetrationbonus" value="0">
   Spell Proficiency: <input type="number" name="attr_SpellProf" readonly/><br>
   Close Range: <input type="number" name="attr_CloseRange" readonly/>
   Medium Range: <input type="number" name="attr_MediumRange" readonly/>
   Long: <input type="number" name="attr_LongRange" readonly/>
  </div>
  <div class="Column1">
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell0minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell0minimize">-</button>
     <span>Simplex Spells</span><br>
     Per Day: <input type="text" readonly name="attr_0perday" value="&infin;"/>
     Remaining: <input type="text" readonly name="attr_0remaining" value="&infin;"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-0">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell0minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell0minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      &nbsp;Simplex
     </span>
        <input style="float:right; width: 40px;" type="text" readonly="true" name="attr_prepared" value="&infin;">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell2minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell2minimize">-</button>
     <span>Level 2 Spells</span><br>
     Per Day: <input type="number" name="attr_2perday"/>
     Remaining: <input type="number" name="attr_2remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-2">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell2minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell2minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell4minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell4minimize">-</button>
     <span>Level 4 Spells</span><br>
     Per Day: <input type="number" name="attr_4perday"/>
     Remaining: <input type="number" name="attr_4remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-4">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell4minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell4minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell6minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell6minimize">-</button>
     <span>Level 6 Spells</span><br>
     Per Day: <input type="number" name="attr_6perday"/>
     Remaining: <input type="number" name="attr_6remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-6">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell6minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell6minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell8minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell8minimize">-</button>
     <span>Level 8 Spells</span><br>
     Per Day: <input type="number" name="attr_8perday"/>
     Remaining: <input type="number" name="attr_8remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-8">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell8minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell8minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
  </div>
  <div class="Column2">
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell1minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell1minimize">-</button>
     <span>Level 1 Spells</span><br>
     Per Day: <input type="number" name="attr_1perday"/>
     Remaining: <input type="number" name="attr_1remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-1">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell1minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell1minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell3minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell3minimize">-</button>
     <span>Level 3 Spells</span><br>
     Per Day: <input type="number" name="attr_3perday"/>
     Remaining: <input type="number" name="attr_3remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-3">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell3minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell3minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell5minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell5minimize">-</button>
     <span>Level 5 Spells</span><br>
     Per Day: <input type="number" name="attr_5perday"/>
     Remaining: <input type="number" name="5attr_5remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-5">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell5minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell5minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell7minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell7minimize">-</button>
     <span>Level 7 Spells</span><br>
     Per Day: <input type="number" name="attr_7perday"/>
     Remaining: <input type="number" name="attr_7remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-7">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell7minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell7minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description">
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
   <div class="Spell-Level">
    <input class="sptoggle" type="hidden" name="attr_spell9minimizetoggle" value="1"/>
    <div class="Spell-Level-Name"><button type="action" class="Small-Button" name="act_spell9minimize">-</button>
     <span>Level 9 Spells</span><br>
     Per Day: <input type="number" name="attr_9perday"/>
     Remaining: <input type="number" name="attr_9remaining"/>
    </div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_spells-9">
      <div class="minimizable-repeat-spells">
       <input type="hidden" class="spells-toggle" name="attr_spell9minimizetoggle" value="1"/>
       <div class="spelltitle">
        <button type="action" class="Small-Button" name="act_spell9minimize">-</button>
        <button style="float:right" type="roll" name="roll-spell-card" value="@{spellcard}"></button>
        <input type="text" name="attr_spellname" placeholder="<Spell Name Here>"/>
        <input type="hidden" name="attr_spellcard"/><br>
        <span style="float:left; color: #FFFFFF">
      Known&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_known">
        <span style="float:left; color: #FFFFFF">
      &nbsp;&nbsp;Memorized&nbsp;
     </span>
        <input style="margin-top: 3px; float:left;" type="checkbox" name="attr_memorized">
        <input style="float:right; width: 40px;" type="text" name="attr_prepared" placeholder="#">
        <span style="float:right; color: #FFFFFF">
      Number Prepared:&nbsp;
     </span>
       </div>
       <div class="spells_description">
        <div class="Details-1">
         <div>School: <input type="text" name=attr_school"/></div>
         <div>Casting Time: <input type="text" name="attr_castingtime"/></div>
         <div>Effect: <input type="text" name="attr_effect"/></div>
         <div>Saving Throw:
          <select name="attr_spellsaving" value="N/A" class="spellselect">
           <option value="No">None</option>
           <option value="Fortitude">Fortitude</option>
           <option value="Reflex">Reflex</option>
           <option value="Will">Will</option>
          </select>
         </div>
         <div>
          Type of Spell:
          <select style="font-size: 12px" name="attr_category" value="" class="spellselect">
           <option value="0">Utility</option>
           <option value="Healing">Healing</option>
           <option value="Damage">Damage</option>
           <option value="Warding">Warding</option>
          </select>
         </div>
         <div>Harmless?<input type="checkbox" name="attr_harmless" value="; harmless"/></div>
        </div>
        <div class="Details-2">
         <div>Components: <input type="text" name="attr_components"/></div>
         <div>Range: <input type="text" name="attr_range"/></div>
         <div>Duration: <input type="text" name="attr_duration"/></div>
         <div>Dice Rolled:<span style="float: right; background-color: #FFFFFF"><input style="float:none" type="text" name="attr_dicenum" placeholder="#"><input style="float:none" type="text" name="attr_dicetype" placeholder="d#"></span></div>
         <div>Spell Resistance?<input type="checkbox" name="attr_sr" value="1"/></div>
        </div>
        <div class="Description" >
         <div>Description:<br><textarea name="attr_spelldescription"></textarea></div>
        </div>
       </div>
      </div>
     </fieldset>
    </div>
   </div>
  </div>
 </div>
</div>

<!--</editor-fold>-->

<!--<editor-fold desc="Accessories">-->
<div class="sheet-accessories">
 <div class="accessories-grid">
  <div class="HeaderM">
   <div><h3>Accessories</h3></div>
  </div>
  <div class="Column1">
   <div><h4>Crown</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Crown_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Hat_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Hat_Color.png"/>
    <input class="titleinput" type="text" name="attr_Crown" placeholder="(Headband, Helmet, of Phylactery)"/>
    <textarea name="attr_CrownDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Face</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Face_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Face_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Face_Color.png"/>
    <input type="text" name="attr_Face" placeholder="(Mask or Goggles)"/>
    <textarea name="attr_FaceDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Neck</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Neck_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Neck_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Neck_Color.png"/>
    <input type="text" name="attr_Neck" placeholder="(Amulet, Brooch, Medallion, Periapt, or Scarab)"/><br>
    <textarea name="attr_NeckDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Shoulders</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Shoulders_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Shoulders_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Shoulders_Color.png"/>
    <input type="text" name="attr_Shoulders" placeholder="(Cloak, Cape, or Mantle)"/><br>
    <textarea name="attr_ShoulderDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Ring 1</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Ring1_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Ring1_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Ring1_Color.png"/>
    <input type="text" name="attr_Ring1" placeholder="(Ring)"/><br>
    <textarea name="attr_Ring1Desc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Ring 2</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Ring2_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Ring2_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Ring2_Color.png"/>
    <input type="text" name="attr_Ring2" placeholder="(Ring)"/><br>
    <textarea name="attr_Ring2Desc" placeholder="Enter details of the magical item here."></textarea>
   </div>
  </div>
  <div class="Column2">
   <div><h4>Hands</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Hands_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Gloves_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Gloves_Color.png"/>
    <input type="text" name="attr_Hands" placeholder="(Gloves or Gauntlets)"/><br>
    <textarea name="attr_HandsDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Forearms</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Forearms_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Forearm_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Forearm_Color.png"/>
    <input type="text" name="attr_Forearms" placeholder="(Bracers or Bracelets)"/><br>
    <textarea name="attr_ForearmDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Upper Arms</h4>
    <input class="titleinputhidden" type="hidden" name="attr_UpperArms_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/UpperArm_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/UpperArm_Color.png"/>
    <input type="text" name="attr_UpperArms" placeholder="(Bangle or Phylactery)"/><br>
    <textarea name="attr_UpperArmDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Torso</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Torso_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Chest_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Chest_Color.png"/>
    <input type="text" name="attr_Torso" placeholder="(Vest, Vestment, or Shirt)"/><br>
    <textarea name="attr_TorsoDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Waist</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Waist_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Belt_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Belt_Color.png"/>
    <input type="text" name="attr_Waist" placeholder="(Belt or Girdle)"/><br>
    <textarea name="attr_BeltDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
   <div><h4>Feet</h4>
    <input class="titleinputhidden" type="hidden" name="attr_Feet_hidden" value="">
    <img class="shadow" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Boots_Shadow.png"/>
    <img class="color" src="https://roll20-charsheet-assets.s3.us-west-2.amazonaws.com/Accessories_Icons_Cropped/Boots_Color.png"/>
    <input type="text" name="attr_Feet" placeholder="(Boots, Shoes, or Slippers)"/><br>
    <textarea name="attr_FeetDesc" placeholder="Enter details of the magical item here."></textarea>
   </div>
  </div>
 </div>
</div>
<!--</editor-fold>-->

 <!--<editor-fold desc="Inventory"-->
 <div class="sheet-inventory">
  <div class="inventory-grid">
   <div class="Header-I">
    <div><h3>Inventory</h3>Gold: <input style="width:104px" type="number" step="any" name="attr_GP"/></div>
   </div>
   <div class="Column-I">
    <div><h4>Primary Inventory</h4></div>
    <div class="sheet-repeating-fields">
     <fieldset class="repeating_maininventory">
      <div class="bag-grid bags">
       <div class="name">
        <div><textarea name="attr_main-inv-name" placeholder="Item name, description, notes etc..."/></div>
       </div>
       <div class="quantity">
        <div>Quantity: <input type="text" name="attr_mainquantity"/></div>
       </div>
       <div class="piece-weight">
        <div>Unit Weight: <input type="text" name="attr_mainpieceweight"/></div>
       </div>
       <div class="total-weight">
        <div>Total Weight: <input type="text" name="attr_maintotalweight" readonly/></div>
       </div>
      </div>
     </fieldset>
     <span class="inventory-weight" style="float:right">Total Inventory Weight:<input name="attr_totalweight" type="text" readonly/></span>
    </div>
   </div>
  </div>
 </div>

 <!--</editor-fold>-->

<!--<editor-fold desc="Java Script">-->

<!--type="text/worker"-->

<script>

    <!--<script type="text/worker">-->

    //<editor-fold desc="Inventory Calculations">

    on("change:repeating_maininventory remove:repeating_maininventory", function(){
        getSectionIDs("repeating_maininventory",function(array){
            let AttrsToGet = [];
            for (let arrayID of array){
                AttrsToGet.push(`repeating_maininventory_${arrayID}_maintotalweight`);
            }console.log("got to before getAttrs");
            getAttrs(AttrsToGet,function(values){
                let total = 0;
                for (let [key, value] of Object.entries(values)){
                    total += parseFloat(value)||0;
                }
                setAttrs({
                    totalweight:total
                });console.log("got to the end");
            });
        });
    });

    on("change:repeating_maininventory:mainquantity " +
        "change:repeating_maininventory:mainpieceweight", function(){
        getAttrs(["repeating_maininventory_mainquantity",
            "repeating_maininventory_mainpieceweight"], function(values){
            let quantity = parseFloat(values.repeating_maininventory_mainquantity)||0;
            let weight = parseFloat(values.repeating_maininventory_mainpieceweight)||0;
            let total = (quantity * weight);
            setAttrs({
                repeating_maininventory_maintotalweight : total
            });
        });
    })

    //</editor-fold>

    //<editor-fold desc="Base Attack and Size Calculations">

    on("change:size sheet:opened",function(){
        getAttrs(["size"], function(values){
            let size = 0;
            if (values.size === "Sub Tiny") {
                size = -8;
            }if (values.size === "Tiny") {
                size = -4;
            }if (values.size === "Very Small") {
                size = -2;
            }if (values.size === "Small") {
                size = -1;
            }if (values.size === "Medium") {
                size = 0;
            }if (values.size === "Large") {
                size = 1;
            }if (values.size === "Very Large") {
                size = 2;
            }if (values.size === "Gargantuan") {
                size = 4;
            }if (values.size === "Super Gargantuan") {
                size = 8;
            }
            setAttrs({
                SizeMod: size
            });
        });
    });

    on("change:hd change:strmod change:dexmod change:attackcurve sheet:opened", function(){
        getAttrs(["HD","AttackCurve"],function(values){
            let HD = parseFloat(values.HD)||0;
            let BAB = HD;
            if(values.AttackCurve === "Medium"){
                BAB = Math.floor(HD * .75);
            }if(values.AttackCurve === "Low"){
                BAB = Math.floor(HD * .5);
            }
            setAttrs({
                BAB: BAB
            });
        });
    });

    //</editor-fold>

    // <editor-fold desc="Advanced Combat Maneuvers">

    on("change:hd change:dexmod change:magictouchattackmisc change:spellprof" +
        " change:focusench change:magictouchattacktemp change:magictouchattackfeat" +
        " sheet:opened",function(){
        getAttrs(["BAB","dexmod","MagicTouchAttackMisc","SpellProf","FocusEnch"
        ,"MagicTouchAttackTemp", "MagicTouchAttackFeat"],function(values){
            let BAB = parseFloat(values.BAB)||0;
            let Dex = parseFloat(values.dexmod)||0;
            let Misc = parseFloat(values.MagicTouchAttackMisc)||0;
            let SpellProf = parseFloat(values.SpellProf)||0;
            let FocusEnch = parseFloat(values.FocusEnch)||0;
            let Temp = parseFloat(values.MagicTouchAttackTemp)||0;
            let Feat = parseFloat(values.MagicTouchAttackFeat)||0;
            let total = BAB + Dex + Misc + SpellProf + FocusEnch + Temp + Feat;
            setAttrs({
                MagicTouchAttack: total
            });
        });
    });

    on("change:hd change:dexmod change:martialtouchattackmisc " +
        "change:martialtouchattacktemp change:martialtouchattackfeat" +
        " sheet:opened change:strmod",function(){
        getAttrs(["BAB","dexmod","MartialTouchAttackMisc","strmod",
            "MartialTouchAttackTemp", "MartialTouchAttackFeat"],function(values){
            let BAB = parseFloat(values.BAB)||0;
            let Dex = parseFloat(values.dexmod)||0;
            let Str = parseFloat(values.strmod)||0;
            let Misc = parseFloat(values.MartialTouchAttackMisc)||0;
            let Temp = parseFloat(values.MartialTouchAttackTemp)||0;
            let Feat = parseFloat(values.MartialTouchAttackFeat)||0;
            let total = BAB + Math.max(Dex,Str) + Misc +  Temp + Feat;
            setAttrs({
                MartialTouchAttack: total
            });
        });
    });

    on("change:strmod change:dexmod change:tripopposedmisc change:tripopposedfeat " +
        "change:tripopposedtemp change:sizemod sheet:opened",function(){
        getAttrs(["strmod","TripOpposedMisc","TripOpposedFeat","TripOpposedTemp","SizeMod"],function (values){
            let Str = parseFloat(values.strmod)||0;
            let Misc = parseFloat(values.TripOpposedMisc)||0;
            let Feat = parseFloat(values.TripOpposedFeat)||0;
            let Temp = parseFloat(values.TripOpposedTemp)||0;
            let Size = parseFloat(values.SizeMod)||0;
            let total = Str + Misc + Feat + Temp + Size;
            setAttrs({
                TripOpposed: total
            });
        });
    });

    on("change:strmod change:dexmod change:shoveopposedmisc change:shoveopposedfeat " +
        "change:shoveopposedtemp change:sizemod sheet:opened",function(){
        getAttrs(["strmod","dexmod","ShoveOpposedMisc","ShoveOpposedFeat","ShoveOpposedTemp","SizeMod"],function (values){
            let Str = parseFloat(values.strmod)||0;
            let Dex = parseFloat(values.dexmod)||0;
            let Misc = parseFloat(values.ShoveOpposedMisc)||0;
            let Feat = parseFloat(values.ShoveOpposedFeat)||0;
            let Temp = parseFloat(values.ShoveOpposedTemp)||0;
            let Size = parseFloat(values.SizeMod)||0;
            let total = Math.max(Str,Dex) + Misc + Feat + Temp + Size;
            setAttrs({
                ShoveOpposed: total
            });
        });
    });

    on("change:hd change:bab change:sizemod change:strmod change:grapplemisc change:grapplefeat " +
        "change:grappletemp change:attackcurve sheet:opened",function() {
        getAttrs(["BAB", "SizeMod", "GrappleMisc","strmod","GrappleTemp","GrappleFeat"], function (values) {
            let BAB = parseFloat(values.BAB) || 0;
            let Str = parseFloat(values.strmod) || 0;
            let Misc = parseFloat(values.GrappleMisc) || 0;
            let Temp = parseFloat(values.GrappleTemp) || 0;
            let Feat = parseFloat(values.GrappleFeat) || 0;
            let size =parseFloat(values.SizeMod) || 0;
            let total = BAB + Misc + Feat + Temp + size + Str;
            setAttrs({
                Grapple: total
            });
        });
    });

    //</editor-fold>

    //<editor-fold desc="Wound DC Calc"">
    on("change:conmod change:hd sheet:opened",function(){
        getAttrs(["HD","conmod"],function(values){
            let HD = parseFloat(values.HD)||0;
            let Con = parseFloat(values.conmod)||0;
            let WoundDC = 12 + HD - Con;
            setAttrs({
                WoundDC: WoundDC
            });
        });
    });
    //</editor-fold>

    //<editor-fold desc="Skill Fuster Cluck">

    //Max Skill Points per HD

    var skill_cap_calc = function(hitdie, trained){
        if(trained === "0"){
            return Math.floor((hitdie + 3)/2);
        }
        return hitdie + 3;
    }

    //<editor-fold desc="Skill Point Totaler">
    var checkmaxskillpoints = function() {
        getAttrs([
            "AcrobaticsSP",
            "BalanceSP",
            "BeguileSP",
            "BushcraftSP",
            "ConcealSP",
            "ConcentrationSP",
            "CounterfeitSP",
            "Craft1SP",
            "Craft2SP",
            "Craft3SP",
            "DiscernIntentSP",
            "DiplomacySP",
            "DisguiseSP",
            "EscapeArtistSP",
            "GatherInformationSP",
            "HaggleSP",
            "HealSP",
            "IntimidateSP",
            "InvestigateSP",
            "Knowledge1SP",
            "Knowledge2SP",
            "Knowledge3SP",
            "Knowledge4SP",
            "Knowledge5SP",
            "Knowledge6SP",
            "ListenSP",
            "LockpickingSP",
            "MoveSilentlySP",
            "Perform1SP",
            "Perform2SP",
            "Perform3SP",
            "Profession1SP",
            "Profession2SP",
            "RideSP",
            "SleightOfHandSP",
            "SpotSP",
            "SabotageDeviceSP",
            "SwimSP",
            "UseRopeSP",
            "NatIntMod",
            "BaseSkillGrowth",
            "HD"], function (values) {
            let CurrentSkillPoints = parseFloat(values.AcrobaticsSP
            ) + parseFloat(values.BalanceSP
            ) + parseFloat(values.BeguileSP
            ) + parseFloat(values.BushcraftSP
            ) + parseFloat(values.ConcealSP
            ) + parseFloat(values.ConcentrationSP
            ) + parseFloat(values.CounterfeitSP
            ) + parseFloat(values.Craft1SP
            ) + parseFloat(values.Craft2SP
            ) + parseFloat(values.Craft3SP
            ) + parseFloat(values.DiscernIntentSP
            ) + parseFloat(values.DiplomacySP
            ) + parseFloat(values.DisguiseSP
            ) + parseFloat(values.EscapeArtistSP
            ) + parseFloat(values.GatherInformationSP
            ) + parseFloat(values.HaggleSP
            ) + parseFloat(values.HealSP
            ) + parseFloat(values.IntimidateSP
            ) + parseFloat(values.InvestigateSP
            ) + parseFloat(values.Knowledge1SP
            ) + parseFloat(values.Knowledge2SP
            ) + parseFloat(values.Knowledge3SP
            ) + parseFloat(values.Knowledge4SP
            ) + parseFloat(values.Knowledge5SP
            ) + parseFloat(values.Knowledge6SP
            ) + parseFloat(values.ListenSP
            ) + parseFloat(values.LockpickingSP
            ) + parseFloat(values.MoveSilentlySP
            ) + parseFloat(values.Perform1SP
            ) + parseFloat(values.Perform2SP
            ) + parseFloat(values.Perform3SP
            ) + parseFloat(values.Profession1SP
            ) + parseFloat(values.Profession2SP
            ) + parseFloat(values.RideSP
            ) + parseFloat(values.SleightOfHandSP
            ) + parseFloat(values.SpotSP
            ) + parseFloat(values.SabotageDeviceSP
            ) + parseFloat(values.SwimSP
            ) + parseFloat(values.UseRopeSP);
            let MaxSkillPoints = ((parseFloat(values.HD) || 0) + 3) * ((parseFloat(values.NatIntMod) || 0) +
                (parseFloat(values.BaseSkillGrowth) || 0));
            setAttrs({
                TotalPossibleSkillPoints: MaxSkillPoints,
                RemainingSkillPoints: MaxSkillPoints - CurrentSkillPoints
            });
        });
    }
    //</editor-fold>
    on("change:intelligence change:intbonus change:intench change:intpen sheet:opened " +
        "change:versatile change:specialty change:magiccurve change:attackcurve change:hd change:intmod",function(){
        getAttrs(["Specialty","AttackCurve","Versatile"],function(values){
            let attack = 2;
            let specialty = 0;
            let versatile = 0;
            if(values.AttackCurve === "Medium"){
                attack = 4;
            }if(values.Specialty === "Specialist"){
                specialty = 4;
            }if(values.Specialty === "Generalist"){
                specialty = 2;
            }
            if(values.Versatile === "on"){
                versatile = 1;
            }
            setAttrs({
                BaseSkillGrowth: attack + specialty + versatile
            });
        });
    });

    on("change:intelligence change:intbonus change:intench change:intpen change:baseskillgrowth sheet:opened " +
        "change:versatile change:specialty change:magiccurve change:attackcurve change:hd change:intmod", function() {
        getAttrs(["intelligence", "IntBonus", "IntPen","BaseSkillGrowth"], function(values) {
            let SkillGrowth = parseFloat(values.BaseSkillGrowth)||0;
            let base = parseFloat(values.intelligence)||0;
            let bonus = parseFloat(values.IntBonus)||0;
            let penalty = parseFloat(values.IntPen)||0;
            let total = base + bonus - penalty;
            let mod = Math.floor((total-10)/2)
            setAttrs({
                NatIntMod: mod,
                SkillsKnown: mod + SkillGrowth + 4
            });
        });
    });

    on("change:acrobaticssp change:acrobaticsmisc change:strmod change:checkpen change:shieldcheckpen sheet:opened",function(){
        getAttrs(["AcrobaticsSP","AcrobaticsMisc","strmod","HD","AcrobaticsTrained","CheckPen","ShieldCheckPen"],function(values){
            let SP = parseFloat(values.AcrobaticsSP)||0;
            let misc = parseFloat(values.AcrobaticsMisc)||0;
            let key = parseFloat(values.strmod)||0;
            let HD = parseFloat(values.HD)||0;
            let CheckPen = parseFloat(values.CheckPen)||0;
            CheckPen = CheckPen + (parseFloat(values.ShieldCheckPen)||0);
            setAttrs({
                AcrobaticsTotal: Math.min(skill_cap_calc(HD,values.AcrobaticsTrained),SP) + key + misc - CheckPen,
                AcrobaticsSP: Math.min(skill_cap_calc(HD,values.AcrobaticsTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:balancesp change:balancemisc change:dexmod sheet:opened",function(){
        getAttrs(["BalanceSP","BalanceMisc","dexmod","HD","BalanceTrained"],function(values){
            let SP = parseFloat(values.BalanceSP)||0;
            let misc = parseFloat(values.BalanceMisc)||0;
            let key = parseFloat(values.dexmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                BalanceTotal: Math.min(skill_cap_calc(HD,values.BalanceTrained),SP) + key + misc,
                BalanceSP: Math.min(skill_cap_calc(HD,values.BalanceTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:beguilesp change:beguilemisc change:chamod sheet:opened",function(){
        getAttrs(["BeguileSP","BeguileMisc","chamod","HD","BeguileTrained"],function(values){
            let SP = parseFloat(values.BeguileSP)||0;
            let misc = parseFloat(values.BeguileMisc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                BeguileTotal: Math.min(skill_cap_calc(HD,values.BeguileTrained),SP) + key + misc,
                BeguileSP: Math.min(skill_cap_calc(HD,values.BeguileTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:bushcraftsp change:bushcraftmisc change:wismod sheet:opened",function(){
        getAttrs(["BushcraftSP","BushcraftMisc","wismod","HD","BushcraftTrained"],function(values){
            let SP = parseFloat(values.BushcraftSP)||0;
            let misc = parseFloat(values.BushcraftMisc)||0;
            let key = parseFloat(values.wismod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                BushcraftTotal: Math.min(skill_cap_calc(HD,values.BushcraftTrained),SP) + key + misc,
                BushcraftSP: Math.min(skill_cap_calc(HD,values.BushcraftTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:concealsp change:concealmisc change:dexmod sheet:opened",function(){
        getAttrs(["ConcealSP","ConcealMisc","dexmod","HD","ConcealTrained"],function(values){
            let SP = parseFloat(values.ConcealSP)||0;
            let misc = parseFloat(values.ConcealMisc)||0;
            let key = parseFloat(values.dexmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                ConcealTotal: Math.min(skill_cap_calc(HD,values.ConcealTrained),SP) + key + misc,
                ConcealSP: Math.min(skill_cap_calc(HD,values.ConcealTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:concentrationsp change:concentrationmisc change:conmod sheet:opened",function(){
        getAttrs(["ConcentrationSP","ConcentrationMisc","conmod","HD","ConcentrationTrained"],function(values){
            let SP = parseFloat(values.ConcentrationSP)||0;
            let misc = parseFloat(values.ConcentrationMisc)||0;
            let key = parseFloat(values.conmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                ConcentrationTotal: Math.min(skill_cap_calc(HD,values.ConcentrationTrained),SP) + key + misc,
                ConcentrationSP: Math.min(skill_cap_calc(HD,values.ConcentrationTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:counterfeitsp change:counterfeitmisc change:intmod sheet:opened",function(){
        getAttrs(["CounterfeitSP","CounterfeitMisc","intmod","HD","CounterfeitTrained"],function(values){
            let SP = parseFloat(values.CounterfeitSP)||0;
            let misc = parseFloat(values.CounterfeitMisc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                CounterfeitTotal: Math.min(skill_cap_calc(HD,values.CounterfeitTrained),SP) + key + misc,
                CounterfeitSP: Math.min(skill_cap_calc(HD,values.CounterfeitTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:craft1sp change:craft1misc change:intmod sheet:opened",function(){
        getAttrs(["Craft1SP","Craft1Misc","intmod","HD","Craft1Trained"],function(values){
            let SP = parseFloat(values.Craft1SP)||0;
            let misc = parseFloat(values.Craft1Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Craft1Total: Math.min(skill_cap_calc(HD,values.Craft1Trained),SP) + key + misc,
                Craft1SP: Math.min(skill_cap_calc(HD,values.Craft1Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:craft2sp change:craft2misc change:intmod sheet:opened",function(){
        getAttrs(["Craft2SP","Craft2Misc","intmod","HD","Craft2Trained"],function(values){
            let SP = parseFloat(values.Craft2SP)||0;
            let misc = parseFloat(values.Craft2Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Craft2Total: Math.min(skill_cap_calc(HD,values.Craft2Trained),SP) + key + misc,
                Craft2SP: Math.min(skill_cap_calc(HD,values.Craft2Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:craft3sp change:craft3misc change:intmod sheet:opened",function(){
        getAttrs(["Craft3SP","Craft3Misc","intmod","HD","Craft3Trained"],function(values){
            let SP = parseFloat(values.Craft3SP)||0;
            let misc = parseFloat(values.Craft3Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Craft3Total: Math.min(skill_cap_calc(HD,values.Craft3Trained),SP) + key + misc,
                Craft3SP: Math.min(skill_cap_calc(HD,values.Craft3Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:discernintentsp change:discernintentmisc change:wismod sheet:opened",function(){
        getAttrs(["DiscernIntentSP","DiscernIntentMisc","wismod","HD","DiscernIntentTrained"],function(values){
            let SP = parseFloat(values.DiscernIntentSP)||0;
            let misc = parseFloat(values.DiscernIntentMisc)||0;
            let key = parseFloat(values.wismod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                DiscernIntentTotal: Math.min(skill_cap_calc(HD,values.DiscernTrained),SP) + key + misc,
                DiscernIntentSP: Math.min(skill_cap_calc(HD,values.DiscernTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:diplomacysp change:diplomacymisc change:chamod sheet:opened",function(){
        getAttrs(["DiplomacySP","DiplomacyMisc","chamod","HD","DiplomacyTrained"],function(values){
            let SP = parseFloat(values.DiplomacySP)||0;
            let misc = parseFloat(values.DiplomacyMisc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                DiplomacyTotal: Math.min(skill_cap_calc(HD,values.DiplomacyTrained),SP) + key + misc,
                DiplomacySP: Math.min(skill_cap_calc(HD,values.DiplomacyTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:disguisesp change:disguisemisc change:chamod sheet:opened",function(){
        getAttrs(["DisguiseSP","DisguiseMisc","chamod","HD","DisguiseTrained"],function(values){
            let SP = parseFloat(values.DisguiseSP)||0;
            let misc = parseFloat(values.DisguiseMisc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                DisguiseTotal: Math.min(skill_cap_calc(HD,values.DisguiseTrained),SP) + key + misc,
                DisguiseSP: Math.min(skill_cap_calc(HD,values.DisguiseTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:escapeartistsp change:escapeartistmisc change:dexmod sheet:opened",function(){
        getAttrs(["EscapeArtistSP","EscapeArtistMisc","dexmod","HD","EscapeArtistTrained"],function(values){
            let SP = parseFloat(values.EscapeArtistSP)||0;
            let misc = parseFloat(values.EscapeArtistMisc)||0;
            let key = parseFloat(values.dexmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                EscapeArtistTotal: Math.min(skill_cap_calc(HD,values.EscapeArtistTrained),SP) + key + misc,
                EscapeArtistSP: Math.min(skill_cap_calc(HD,values.EscapeArtistTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:gatherinformationsp change:gatherinformationmisc change:chamod sheet:opened",function(){
        getAttrs(["GatherInformationSP","GatherInformationMisc","chamod","HD","GatherInformationTrained"],function(values){
            let SP = parseFloat(values.GatherInformationSP)||0;
            let misc = parseFloat(values.GatherInformationMisc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                GatherInformationTotal: Math.min(skill_cap_calc(HD,values.GatherInformationTrained),SP) + key + misc,
                GatherInformationSP: Math.min(skill_cap_calc(HD,values.GatherInformationTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:hagglesp change:hagglemisc change:chamod sheet:opened",function(){
        getAttrs(["HaggleSP","HaggleMisc","chamod","HD","HaggleTrained"],function(values){
            let SP = parseFloat(values.HaggleSP)||0;
            let misc = parseFloat(values.HaggleMisc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                HaggleTotal: Math.min(skill_cap_calc(HD,values.HaggleTrained),SP) + key + misc,
                HaggleSP: Math.min(skill_cap_calc(HD,values.HaggleTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:healsp change:healmisc change:wismod sheet:opened",function(){
        getAttrs(["HealSP","HealMisc","wismod","HD","HealTrained"],function(values){
            let SP = parseFloat(values.HealSP)||0;
            let misc = parseFloat(values.HealMisc)||0;
            let key = parseFloat(values.wismod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                HealTotal: Math.min(skill_cap_calc(HD,values.HealTrained),SP) + key + misc,
                HealSP: Math.min(skill_cap_calc(HD,values.HealTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:intimidatesp change:intimidatemisc change:chamod sheet:opened",function(){
        getAttrs(["IntimidateSP","IntimidateMisc","chamod","HD","IntimidateTrained"],function(values){
            let SP = parseFloat(values.IntimidateSP)||0;
            let misc = parseFloat(values.IntimidateMisc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                IntimidateTotal: Math.min(skill_cap_calc(HD,values.IntimidateTrained),SP) + key + misc,
                IntimidateSP: Math.min(skill_cap_calc(HD,values.IntimidateTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:investigatesp change:investigatemisc change:intmod sheet:opened",function(){
        getAttrs(["InvestigateSP","InvestigateMisc","intmod","HD","InvestigateTrained"],function(values){
            let SP = parseFloat(values.InvestigateSP)||0;
            let misc = parseFloat(values.InvestigateMisc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                InvestigateTotal: Math.min(skill_cap_calc(HD,values.InvestigateTrained),SP) + key + misc,
                InvestigateSP: Math.min(skill_cap_calc(HD,values.InvestigateTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:knowledge1sp change:knowledge1misc change:intmod sheet:opened",function(){
        getAttrs(["Knowledge1SP","Knowledge1Misc","intmod","HD","Knowledge1Trained"],function(values){
            let SP = parseFloat(values.Knowledge1SP)||0;
            let misc = parseFloat(values.Knowledge1Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Knowledge1Total: Math.min(skill_cap_calc(HD,values.Knowledge1Trained),SP) + key + misc,
                Knowledge1SP: Math.min(skill_cap_calc(HD,values.Knowledge1Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:knowledge2sp change:knowledge2misc change:intmod sheet:opened",function(){
        getAttrs(["Knowledge2SP","Knowledge2Misc","intmod","HD","Knowledge2Trained"],function(values){
            let SP = parseFloat(values.Knowledge2SP)||0;
            let misc = parseFloat(values.Knowledge2Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Knowledge2Total: Math.min(skill_cap_calc(HD,values.Knowledge2Trained),SP) + key + misc,
                Knowledge2SP: Math.min(skill_cap_calc(HD,values.Knowledge2Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:knowledge3sp change:knowledge3misc change:intmod sheet:opened",function(){
        getAttrs(["Knowledge3SP","Knowledge3Misc","intmod","HD","Knowledge3Trained"],function(values){
            let SP = parseFloat(values.Knowledge3SP)||0;
            let misc = parseFloat(values.Knowledge3Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Knowledge3Total: Math.min(skill_cap_calc(HD,values.Knowledge3Trained),SP) + key + misc,
                Knowledge3SP: Math.min(skill_cap_calc(HD,values.Knowledge3Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:knowledge4sp change:knowledge4misc change:intmod sheet:opened",function(){
        getAttrs(["Knowledge4SP","Knowledge4Misc","intmod","HD","Knowledge4Trained"],function(values){
            let SP = parseFloat(values.Knowledge4SP)||0;
            let misc = parseFloat(values.Knowledge4Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Knowledge4Total: Math.min(skill_cap_calc(HD,values.Knowledge4Trained),SP) + key + misc,
                Knowledge4SP: Math.min(skill_cap_calc(HD,values.Knowledge4Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:knowledge5sp change:knowledge5misc change:intmod sheet:opened",function(){
        getAttrs(["Knowledge5SP","Knowledge5Misc","intmod","HD","Knowledge5Trained"],function(values){
            let SP = parseFloat(values.Knowledge5SP)||0;
            let misc = parseFloat(values.Knowledge5Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Knowledge5Total: Math.min(skill_cap_calc(HD,values.Knowledge5Trained),SP) + key + misc,
                Knowledge5SP: Math.min(skill_cap_calc(HD,values.Knowledge5Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:knowledge6sp change:knowledge6misc change:intmod sheet:opened",function(){
        getAttrs(["Knowledge6SP","Knowledge6Misc","intmod","HD","Knowledge6Trained"],function(values){
            let SP = parseFloat(values.Knowledge6SP)||0;
            let misc = parseFloat(values.Knowledge6Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Knowledge6Total: Math.min(skill_cap_calc(HD,values.Knowledge6Trained),SP) + key + misc,
                Knowledge6SP: Math.min(skill_cap_calc(HD,values.Knowledge6Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:listensp change:listenmisc change:wismod sheet:opened",function(){
        getAttrs(["ListenSP","ListenMisc","wismod","HD","ListenTrained"],function(values){
            let SP = parseFloat(values.ListenSP)||0;
            let misc = parseFloat(values.ListenMisc)||0;
            let key = parseFloat(values.wismod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                ListenTotal: Math.min(skill_cap_calc(HD,values.ListenTrained),SP) + key + misc,
                ListenSP: Math.min(skill_cap_calc(HD,values.ListenTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:lockpickingsp change:lockpickingmisc change:dexmod sheet:opened",function(){
        getAttrs(["LockpickingSP","LockpickingMisc","dexmod","HD","LockpickingTrained"],function(values){
            let SP = parseFloat(values.LockpickingSP)||0;
            let misc = parseFloat(values.LockpickingMisc)||0;
            let key = parseFloat(values.dexmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                LockpickingTotal: Math.min(skill_cap_calc(HD,values.LockpickingTrained),SP) + key + misc,
                LockpickingSP: Math.min(skill_cap_calc(HD,values.LockpickingTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:movesilentlysp change:movesilentlymisc change:dexmod change:checkpen change:shieldcheckpen sheet:opened",function(){
        getAttrs(["MoveSilentlySP","MoveSilentlyMisc","dexmod","MoveSilentlyTrained","HD","CheckPen","ShieldCheckPen"],function(values){
            let SP = parseFloat(values.MoveSilentlySP)||0;
            let misc = parseFloat(values.MoveSilentlyMisc)||0;
            let key = parseFloat(values.dexmod)||0;
            let HD = parseFloat(values.HD)||0;
            let CheckPen = parseFloat(values.CheckPen)||0;
            CheckPen = CheckPen + (parseFloat(values.ShieldCheckPen)||0);
            setAttrs({
                MoveSilentlyTotal: Math.min(skill_cap_calc(HD,values.MoveSilentlyTrained),SP) + key + misc - CheckPen,
                MoveSilentlySP: Math.min(skill_cap_calc(HD,values.MoveSilentlyTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:perform1sp change:perform1misc change:chamod sheet:opened",function(){
        getAttrs(["Perform1SP","Perform1Misc","chamod","HD","Perform1Trained"],function(values){
            let SP = parseFloat(values.Perform1SP)||0;
            let misc = parseFloat(values.Perform1Misc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Perform1Total: Math.min(skill_cap_calc(HD,values.Perform1Trained),SP) + key + misc,
                Perform1SP: Math.min(skill_cap_calc(HD,values.Perform1Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:perform2sp change:perform2misc change:chamod sheet:opened",function(){
        getAttrs(["Perform2SP","Perform2Misc","chamod","HD","Perform2Trained"],function(values){
            let SP = parseFloat(values.Perform2SP)||0;
            let misc = parseFloat(values.Perform2Misc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Perform2Total: Math.min(skill_cap_calc(HD,values.Perform2Trained),SP) + key + misc,
                Perform2SP: Math.min(skill_cap_calc(HD,values.Perform2Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:perform3sp change:perform3misc change:chamod sheet:opened",function(){
        getAttrs(["Perform3SP","Perform3Misc","chamod","HD","Perform3Trained"],function(values){
            let SP = parseFloat(values.Perform3SP)||0;
            let misc = parseFloat(values.Perform3Misc)||0;
            let key = parseFloat(values.chamod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Perform3Total: Math.min(skill_cap_calc(HD,values.Perform3Trained),SP) + key + misc,
                Perform3SP: Math.min(skill_cap_calc(HD,values.Perform3Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:profession1sp change:profession1misc change:intmod sheet:opened",function(){
        getAttrs(["Profession1SP","Profession1Misc","intmod","HD","Profession1Trained"],function(values){
            let SP = parseFloat(values.Profession1SP)||0;
            let misc = parseFloat(values.Profession1Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Profession1Total: Math.min(skill_cap_calc(HD,values.Profession1Trained),SP) + key + misc,
                Profession1SP: Math.min(skill_cap_calc(HD,values.Profession1Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:profession2sp change:profession2misc change:intmod sheet:opened",function(){
        getAttrs(["Profession2SP","Profession2Misc","intmod","HD","Profession2Trained"],function(values){
            let SP = parseFloat(values.Profession2SP)||0;
            let misc = parseFloat(values.Profession2Misc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                Profession2Total: Math.min(skill_cap_calc(HD,values.Profession2Trained),SP) + key + misc,
                Profession2SP: Math.min(skill_cap_calc(HD,values.Profession2Trained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:ridesp change:ridemisc change:dexmod change:checkpen change:shieldcheckpen sheet:opened",function(){
        getAttrs(["RideSP","RideMisc","dexmod","HD","RideTrained","CheckPen","ShieldCheckPen"],function(values){
            let SP = parseFloat(values.RideSP)||0;
            let misc = parseFloat(values.RideMisc)||0;
            let key = parseFloat(values.dexmod)||0;
            let HD = parseFloat(values.HD)||0;
            let CheckPen = parseFloat(values.CheckPen)||0;
            CheckPen = CheckPen + (parseFloat(values.ShieldCheckPen)||0);
            setAttrs({
                RideTotal: Math.min(skill_cap_calc(HD,values.RideTrained),SP) + key + misc - CheckPen,
                RideSP: Math.min(skill_cap_calc(HD,values.RideTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:sleightofhandsp change:sleightofhandmisc change:dexmod sheet:opened",function(){
        getAttrs(["SleightOfHandSP","SleightOfHandMisc","dexmod","HD","SleightOfHandTrained"],function(values){
            let SP = parseFloat(values.SleightOfHandSP)||0;
            let misc = parseFloat(values.SleightOfHandMisc)||0;
            let key = parseFloat(values.dexmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                SleightOfHandTotal: Math.min(skill_cap_calc(HD,values.SleightOfHandTrained),SP) + key + misc,
                SleightOfHandSP: Math.min(skill_cap_calc(HD,values.SleightOfHandTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:spotsp change:spotmisc change:wismod sheet:opened",function(){
        getAttrs(["SpotSP","SpotMisc","wismod","HD","SpotTrained"],function(values){
            let SP = parseFloat(values.SpotSP)||0;
            let misc = parseFloat(values.SpotMisc)||0;
            let key = parseFloat(values.wismod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                SpotTotal: Math.min(skill_cap_calc(HD,values.SpotTrained),SP) + key + misc,
                SpotSP: Math.min(skill_cap_calc(HD,values.SpotTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:sabotagedevicesp change:sabotagedevicemisc change:intmod sheet:opened",function(){
        getAttrs(["SabotageDeviceSP","SabotageDeviceMisc","intmod","HD","SabotageDeviceTrained"],function(values){
            let SP = parseFloat(values.SabotageDeviceSP)||0;
            let misc = parseFloat(values.SabotageDeviceMisc)||0;
            let key = parseFloat(values.intmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                SabotageDeviceTotal: Math.min(skill_cap_calc(HD,values.SabotageDeviceTrained),SP) + key + misc,
                SabotageDeviceSP: Math.min(skill_cap_calc(HD,values.SabotageDeviceTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:swimsp change:swimmisc change:strmod change:checkpen change:shieldcheckpen sheet:opened",function(){
        getAttrs(["SwimSP","SwimMisc","strmod","HD","SwimTrained","CheckPen","ShieldCheckPen"],function(values){
            let SP = parseFloat(values.SwimSP)||0;
            let misc = parseFloat(values.SwimMisc)||0;
            let key = parseFloat(values.strmod)||0;
            let HD = parseFloat(values.HD)||0;
            let CheckPen = parseFloat(values.CheckPen)||0;
            CheckPen = CheckPen + (parseFloat(values.ShieldCheckPen)||0);
            setAttrs({
                SwimTotal: Math.min(skill_cap_calc(HD,values.SwimTrained),SP) + key + misc - CheckPen,
                SwimSP: Math.min(skill_cap_calc(HD,values.SwimTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    on("change:useropesp change:useropemisc change:dexmod sheet:opened",function(){
        getAttrs(["UseRopeSP","UseRopeMisc","dexmod","HD","UseRopeTrained"],function(values){
            let SP = parseFloat(values.UseRopeSP)||0;
            let misc = parseFloat(values.UseRopeMisc)||0;
            let key = parseFloat(values.dexmod)||0;
            let HD = parseFloat(values.HD)||0;
            setAttrs({
                UseRopeTotal: Math.min(skill_cap_calc(HD,values.UseRopeTrained),SP) + key + misc,
                UseRopeSP: Math.min(skill_cap_calc(HD,values.UseRopeTrained),SP)
            }, checkmaxskillpoints);
        });
    });

    //</editor-fold>

    //<editor-fold desc="Saves">

    on("change:fortbasestr change:conmod change:constitution change:hd sheet:opened",function (){
        getAttrs(["FortBaseStr","HD"],function(values){
            let HD = parseFloat(values.HD);
            let base = 0;
            if(values.FortBaseStr === "Low") {
                base = Math.min(6, Math.floor(HD / 3));
            }if(values.FortBaseStr === "High"){
                base = Math.min(12, Math.floor(2+(HD / 2)));
            }
            setAttrs({
                FortBaseNum: base
            });
        });
    });

    on("change:refbasestr change:dexmod change:dexterity change:hd change:haste change:slow sheet:opened",function (){
        getAttrs(["RefBaseStr","HD","haste","slow"],function(values){
            let HD = parseFloat(values.HD);
            let haste = parseFloat(values.haste);
            let slow = parseFloat(values.slow);
            let base = 0;
            if(values.RefBaseStr === "Low") {
                base = Math.min(6, Math.floor(HD / 3));
            }if(values.RefBaseStr === "High"){
                base = Math.min(12, Math.floor(2+(HD / 2)));
            }
            setAttrs({
                RefBaseNum: base + haste - slow
            });
        });
    });

    on("change:wilbasestr change:wismod change:wisdom change:hd sheet:opened",function (){
        getAttrs(["WilBaseStr","HD"],function(values){
            let HD = parseFloat(values.HD);
            let base = 0;
            if(values.WilBaseStr === "Low") {
                base = Math.min(6, Math.floor(HD / 3));
            }if(values.WilBaseStr === "High"){
                base = Math.min(12, Math.floor(2+(HD / 2)));
            }
            setAttrs({
                WilBaseNum: base
            });
        });
    });

    on("change:fortbasestr change:conmod change:constitution change:hd change:fortbasenum " +
        "change:fortmiscnum change:fortmagic change:forttempnum sheet:opened",function (){
        getAttrs(["FortBaseNum","conmod","FortMagic","FortMiscNum","FortTempNum"],function(values){
            let base = parseFloat(values.FortBaseNum)||0;
            let stat = parseFloat(values.conmod)||0;
            let magic = parseFloat(values.FortMagic)||0;
            let misc = parseFloat(values.FortMiscNum)||0;
            let temp = parseFloat(values.FortTempNum)||0;
            let total = base + stat + magic + temp + misc;
            setAttrs({
                FortTotal: total
            });
        });
    });

    on("change:refbasestr change:dexmod change:dexterity change:hd change:refbasenum " +
        "change:refmiscnum change:refmagic change:reftempnum sheet:opened",function (){
        getAttrs(["RefBaseNum","dexmod","RefMagic","RefMiscNum","RefTempNum"],function(values){
            let base = parseFloat(values.RefBaseNum)||0;
            let stat = parseFloat(values.dexmod)||0;
            let magic = parseFloat(values.RefMagic)||0;
            let misc = parseFloat(values.RefMiscNum)||0;
            let temp = parseFloat(values.RefTempNum)||0;
            let total = base + stat + magic + misc + temp;
            setAttrs({
                RefTotal: total
            });
        });
    });

    on("change:wilbasestr change:wismod change:wisdom change:hd change:wilbasenum " +
        "change:wilmiscnum change:wilmagic change:wiltempnum sheet:opened",function (){
        getAttrs(["WilBaseNum","wismod","WilMagic","WilMiscNum","WilTempNum"],function(values){
            let base = parseFloat(values.WilBaseNum)||0;
            let stat = parseFloat(values.wismod)||0;
            let magic = parseFloat(values.WilMagic)||0;
            let misc = parseFloat(values.WilMiscNum)||0;
            let temp = parseFloat(values.WilTempNum)||0;
            let total = base + stat + magic + misc + temp;
            setAttrs({
                WilTotal: total
            });
        });
    });

    //</editor-fold>

    // <editor-fold desc="AC">
    on("change:shield change:size change:sizemod change:armorbonus change:dexmod change:naturalac change:parryac change:haste change:slow "+
        "change:miscac change:deflection change:insightac change:dodgeac change:dexaclimit change:shielddexaclimit" +
        " sheet:opened",function(){
        getAttrs(["dexmod","ArmorBonus","NaturalAC","Shield","MiscAC","haste","slow",
            "InsightAC","ParryAC","Deflection","DodgeAC","SizeMod","DexACLimit","ShieldDexACLimit"],function(values){
            let dex = parseFloat(values.dexmod)||0;
            let haste = parseFloat(values.haste)||0;
            let slow = parseFloat(values.slow)
            let armor = parseFloat(values.ArmorBonus)||0;
            let natural = parseFloat(values.NaturalAC)||0;
            let shield = parseFloat(values.Shield)||0;
            let parry = parseFloat(values.ParryAC)||0;
            let dodge = parseFloat(values.DodgeAC)||0;
            let deflection = parseFloat(values.Deflection)||0;
            let insight = parseFloat(values.InsightAC)||0;
            let misc = parseFloat(values.MiscAC)||0;
            let ArmorLimit = parseFloat(values.DexACLimit)||9999;
            let ShieldLimit = parseFloat(values.ShieldDexACLimit)||9999;
            let DexLimit = Math.min(ArmorLimit,ShieldLimit);
            let size =  parseFloat(values.SizeMod)||0;
            let total = 10 + Math.min(DexLimit,dex) + armor + natural + shield + haste + parry + dodge + deflection + insight + misc - size - slow;
            let flat = 10 + armor + natural + shield + deflection + misc - size;
            let touch = 10 + Math.min(DexLimit,dex) + dodge + deflection + insight + misc - size + haste - slow;
            setAttrs({
                TotalAC: total,
                FlatFAC: flat,
                TouchAC: touch,
            });
        });
    });
    //</editor-fold>

    //<editor-fold desc="Initiative Calculations"
    on("change:dexmod change:initbonus sheet:opened", function(){
        getAttrs(["dexmod","InitBonus"],function(values){
            let dex = parseFloat(values.dexmod)||0;
            let InitBonus = parseFloat(values.InitBonus)||0;
            let total = dex + InitBonus
            setAttrs({
                InitTotal: total
            });
        });
    });
    //</editor-fold>

    //<editor-fold desc="Button-Tabs"

    const inputlist = ["Crown","Face","Neck","Shoulders","Ring1","Ring2","Hands","Forearms","UpperArms","Torso","Waist","Feet"];
    inputlist.forEach(input =>{
        on(`change:${input.toLowerCase()}`, function(){
            getAttrs([input], function(values){
                let toSetAttrs = {};
                toSetAttrs[`${input}_hidden`] = values[input];
                setAttrs(toSetAttrs);
            })
        })
    })
    const buttonlist = ["main","skills","gear","definitions","abilities","spells","accessories","inventory"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });

    const spellbuttonlist = [0,1,2,3,4,5,6,7,8,9];
    spellbuttonlist.forEach(button => {
        on(`clicked:spell${button}minimize`, function(){
            getAttrs([`spell${button}minimizetoggle`], function(v){
                let toSetAttrs = {};
                toSetAttrs[`spell${button}minimizetoggle`] = 1 - parseInt(v[`spell${button}minimizetoggle`]);
                setAttrs(toSetAttrs);
            });
        });
    });

    const maxAbilityList = ["minabilitytog"];
    maxAbilityList.forEach(button => {
        on(`clicked:repeating_abilities:${button}`, function() {
            getAttrs(['repeating_abilities_minimizeability'], function(v) {
                setAttrs({
                    repeating_abilities_minimizeability: 1 - parseInt(v.repeating_abilities_minimizeability)
                });
            });
        });
    });

    const maxAfflictionsList = ["minafflictions"];
    maxAfflictionsList.forEach(button => {
        on(`clicked:repeating_afflictions:${button}`, function() {
            getAttrs(['repeating_afflictions_minafflictionsval'], function(v) {
                setAttrs({
                    repeating_afflictions_minafflictionsval: 1 - parseInt(v.repeating_afflictions_minafflictionsval)
                });
            });
        });
    });

    const maxFeatsList = ["minfeats"];
    maxFeatsList.forEach(button => {
        on(`clicked:repeating_feats:${button}`, function() {
            getAttrs(['repeating_feats_minfeatval'], function(v) {
                setAttrs({
                    repeating_feats_minfeatval: 1 - parseInt(v.repeating_feats_minfeatval)
                });
            });
        });
    });

    const maxSecDefList = ["minsecdefdesc"];
    maxSecDefList.forEach(button => {
        on(`clicked:repeating_definitions:${button}`, function() {
            getAttrs(['repeating_definitions_minsecdef'], function(v) {
                setAttrs({
                    repeating_definitions_minsecdef: 1 - parseInt(v.repeating_definitions_minsecdef)
                });
            });
        });
    });

    const maxMinSpeciesList = ["minspecies"];
    maxMinSpeciesList.forEach(button => {
        on(`clicked:repeating_species:${button}`, function() {
            getAttrs(['repeating_species_minspeciestrait'], function(v) {
                setAttrs({
                    repeating_species_minspeciestrait: 1 - parseInt(v["repeating_species_minspeciestrait"])
                });
            });
        });
    });

    const maxMinWeaponList = ["weaponminimize","critconfirmminimize"];
    maxMinWeaponList.forEach(button => {
        on(`clicked:repeating_weapons:${button}`, function() {
            getAttrs([`repeating_weapons_${button}toggle`], function(v) {
                let toSetAttrs = {};
                toSetAttrs[`repeating_weapons_${button}toggle`] = 1 - parseInt(v[`repeating_weapons_${button}toggle`]);
                setAttrs(toSetAttrs);
            });
        });
    });

    const maxMinSpellList = ["0_spell0minimize","1_spell1minimize","2_spell2minimize","3_spell3minimize","4_spell4minimize","5_spell5minimize",
        "6_spell6minimize","7_spell7minimize","8_spell8minimize","9_spell9minimize"];
    maxMinSpellList.forEach(button => {
        on(`clicked:repeating_spells-${button.replace("_",":")}`, function() {
            getAttrs([`repeating_spells-${button}toggle`], function(v) {
                let toSetAttrs = {};
                toSetAttrs[`repeating_spells-${button}toggle`] = 1 - parseInt(v[`repeating_spells-${button}toggle`]);
                setAttrs(toSetAttrs);
            });
        });
    });

    //</editor-fold>

    //<editor-fold desc="HP Calculations"

    on("change:conmod change:hd sheet:opened", function(){
        getAttrs(["HD","conmod"],function(values){
            let HD = parseFloat(values.HD)||0;
            let conmod = parseFloat(values.conmod)||0;
            let conhp = HD * conmod
            setAttrs({
                ConHP: conhp
            });
        });
    });

    on("change:hd change:magiccurve sheet:opened", function(){
        getAttrs(["HD","MagicCurve"],function(values){
            let progHP = 0;
            let HD = parseFloat(values.HD)||0;
            if(values.MagicCurve === "None"){
                progHP = 6;
            }if(values.MagicCurve === "Basic"){
                progHP = 5;
            }if(values.MagicCurve === "Standard"){
                progHP = 4;
            }if(values.MagicCurve === "Advanced"){
                progHP = 3;
            }
            setAttrs({
                ProgHP: progHP * HD
            });
        });
    });

    on("change:conhp change:mischp change:proghp change:rollhp sheet:opened", function(){
        getAttrs(["ConHP","ProgHP","MiscHP","RollHP"],function(values){
            let con = parseFloat(values.ConHP)||0;
            let prog = parseFloat(values.ProgHP)||0;
            let misc = parseFloat(values.MiscHP)||0;
            let roll = parseFloat(values.RollHP)||0;
            let total = con + prog + misc + roll;
            if(total === 0){
                total = 1
            }
            setAttrs({
                hp_max: total,
                NLD_max: total,
            });
        });
    });

    //</editor-fold>

    //<editor-fold desc="HD Calculations">

    on("change:hd change:lg sheet:opened", function(){
        getAttrs(["HD", "LG"], function(values){
            let HD = parseFloat(values.HD)||0;
            let LG = parseFloat(values.LG)||0;
            let HDE = HD + LG
            setAttrs({
                HDE: HDE
            });
        });
    });

    //</editor-fold>

    //<editor-fold desc="Statblock"
    on("change:strength change:strbonus change:strench change:strpen sheet:opened", function() {
        getAttrs(["strength", "StrBonus", "StrEnch", "StrPen"], function(values) {
            let base = parseFloat(values.strength)||0;
            let bonus = parseFloat(values.StrBonus)||0;
            let enhancement = parseFloat(values.StrEnch)||0;
            let penalty = parseFloat(values.StrPen)||0;
            let total = base + bonus + enhancement - penalty;
            let mod = Math.floor((total-10)/2)
            setAttrs({
                StrTotal: total,
                strmod: mod
            });
        });
    });
    on("change:dexterity change:dexbonus change:dexench change:dexpen sheet:opened", function() {
        getAttrs(["dexterity", "DexBonus", "DexEnch", "DexPen"], function(values) {
            let base = parseFloat(values.dexterity)||0;
            let bonus = parseFloat(values.DexBonus)||0;
            let enhancement = parseFloat(values.DexEnch)||0;
            let penalty = parseFloat(values.DexPen)||0;
            let total = base + bonus + enhancement - penalty;
            let mod = Math.floor((total-10)/2)
            setAttrs({
                DexTotal: total,
                dexmod: mod
            });
        });
    });
    on("change:constitution change:conbonus change:conench change:conpen sheet:opened", function() {
        getAttrs(["constitution", "ConBonus", "ConEnch", "ConPen"], function(values) {
            let base = parseFloat(values.constitution)||0;
            let bonus = parseFloat(values.ConBonus)||0;
            let enhancement = parseFloat(values.ConEnch)||0;
            let penalty = parseFloat(values.ConPen)||0;
            let total = base + bonus + enhancement - penalty;
            let mod = Math.floor((total-10)/2)
            setAttrs({
                ConTotal: total,
                conmod: mod
            });
        });
    });
    on("change:wisdom change:wisbonus change:wisench change:wispen sheet:opened", function() {
        getAttrs(["wisdom", "WisBonus", "WisEnch", "WisPen"], function(values) {
            let base = parseFloat(values.wisdom)||0;
            let bonus = parseFloat(values.WisBonus)||0;
            let enhancement = parseFloat(values.WisEnch)||0;
            let penalty = parseFloat(values.WisPen)||0;
            let total = base + bonus + enhancement - penalty;
            let mod = Math.floor((total-10)/2)
            setAttrs({
                WisTotal: total,
                wismod: mod
            });
        });
    });
    on("change:intelligence change:intbonus change:intench change:intpen sheet:opened", function() {
        getAttrs(["intelligence", "IntBonus", "IntEnch", "IntPen"], function(values) {
            let base = parseFloat(values.intelligence)||0;
            let bonus = parseFloat(values.IntBonus)||0;
            let enhancement = parseFloat(values.IntEnch)||0;
            let penalty = parseFloat(values.IntPen)||0;
            let total = base + bonus + enhancement - penalty;
            let mod = Math.floor((total-10)/2)
            setAttrs({
                IntTotal: total,
                intmod: mod
            });
        });
    });
    on("change:charisma change:chabonus change:chaench change:chapen sheet:opened", function() {
        getAttrs(["charisma", "ChaBonus", "ChaEnch", "ChaPen"], function(values) {
            let base = parseFloat(values.charisma)||0;
            let bonus = parseFloat(values.ChaBonus)||0;
            let enhancement = parseFloat(values.ChaEnch)||0;
            let penalty = parseFloat(values.ChaPen)||0;
            let total = base + bonus + enhancement - penalty;
            let mod = Math.floor((total-10)/2)
            setAttrs({
                ChaTotal: total,
                chamod: mod
            });
        });
    });
    //</editor-fold>

    // <editor-fold desc="Spellcasting Calculations">

    on(`change:hd change:magiccurve sheet:opened`,function(){
        getAttrs(["HD","MagicCurve"], function(values){
            let HD = parseFloat(values.HD)||0;
            let CL = HD;
            if (values.MagicCurve === "None"){
                CL = 0;
            }
            else if (values.MagicCurve === "Basic"){
                CL = Math.floor(HD/2);
            }
            setAttrs({
                cl : CL
            })
        });
    });

    const SpellMacroLevel = [0,1,2,3,4,5,6,7,8,9];
    SpellMacroLevel.forEach(level => {
        on(`change:repeating_spells-${level}:spellsaving change:repeating_spells-${level}:category change:repeating_spells`+
            `change:repeating_spells-${level}:harmless change:repeating_spells-${level}:sr change:repeating_spells-${level}:spell${level}minimizetoggle `+
            `change:repeating_spells-${level}:minimizetoggle change:repeating_spells-${level}:spellname`, function () {
            getAttrs([`repeating_spells-${level}_spellsaving`,`repeating_spells-${level}_category`,
                    `repeating_spells-${level}_harmless`, `repeating_spells-${level}_sr`],
                function (values) {
                    let save = values[`repeating_spells-${level}_spellsaving`];
                    let type = values[`repeating_spells-${level}_category`];
                    let harmless = values[`repeating_spells-${level}_harmless`];
                    let spell_resistance = values[`repeating_spells-${level}_sr`];
                    let macro = `&{template:custom}{{title=@{spellname}}}{{subtitle=@{school}}}{{Components=@{components}}}`+
                        `{{Range=@{range}}}{{Casting Time=@{castingtime}}}{{Effect=@{effect}}}{{Duration=@{duration}}}`;
                    if (save !== "No") {
                        macro = macro + `{{${save} save= DC [[10+@{PMA}+${level}+@{SpellProf}]]${harmless.replace(`0`,``)}}}`;
                    }
                    if(type !== "0") {
                        macro = macro + `{{${type}=[[@{dicenum}@{dicetype}+(@{dicenum}*@{SpellProf})]]}}`;
                    }
                    if(spell_resistance === "1") {
                        macro = macro + `{{Spell Penetration=[[1d20+@{cl}+@{spellpenetrationbonus}+`+
                            `(0?{Do you have any Spell penetration Bonuses?|0})]]}}`;
                    }
                    macro = macro + `{{desc= @{spelldescription}}}`
                    toSetAttrs = {};
                    toSetAttrs[`repeating_spells-${level}_spellcard`] = macro;
                    setAttrs(toSetAttrs);
                });
        });
    });

    on("change:hd change:magiccurve sheet:opened",function(){
        getAttrs(["HD","MagicCurve"],function(values){
            let HD = parseFloat(values.HD)||0;
            let SP = 0;
            if(values.MagicCurve === "Basic"){
                SP = Math.floor(HD/10);
            }
            if(values.MagicCurve === "Standard"){
                SP = 1 + Math.floor(HD/8);
            }
            if(values.MagicCurve === "Advanced"){
                SP = 1 + Math.floor(HD/6);
            }
            if(values.MagicCurve === "None"){
                SP = 0;
            }
            setAttrs({
                SpellProf: SP
            });
        });
    });
    //</editor-fold>

    // <editor-fold desc="Ability Info Calculations">

    on("change:repeating_abilities:minimizeability change_repeating_abilities:absavethrow " +
        "change:repeating_abilities:abilitytype change:repeating_abilities:abilitysrconfirm " +
        "change:repeating_abilities:asprof change:repeating_abilities", function(){
        getAttrs(["repeating_abilities_absavethrow","repeating_abilities_abilitytype",
            "repeating_abilities_abilitysrconfirm","repeating_abilities_asprof"],function(values){
            let savethrow = (values.repeating_abilities_absavethrow);
            let type = (values.repeating_abilities_abilitytype);
            let sr = (values.repeating_abilities_abilitysrconfirm);
            let SpellProf = (values.repeating_abilities_asprof);
            let Macro = `&{template:custom}{{title=@{abilityname}}}{{subtitle=@{charname}}}{{Range=@{abilityrange}}}`+
                `{{Target=@{abilitytarget}}}{{Duration=@{abilityduration}}}`;
            if(savethrow !== "N/A"){
                Macro = Macro + `{{${savethrow} save=@{abilitydc}}}`;
            }
            if(type !== "0"){
                Macro = Macro + `{{${type}=[[(@{abilitydicenum}@{abilitydicetype})]]}}`;
            }
            if(SpellProf === "1"){
                Macro = Macro.replace(`{{${type}=[[(@{abilitydicenum}@{abilitydicetype})]]}}`,
                    `{{${type}=[[(@{abilitydicenum}@{abilitydicetype})+(@{SpellProf}*@{abilitydicenum})]]}}`);
            }
            if(sr === "1"){
                Macro = Macro + `{{Spell Resistance=[[1d20+@{HD}+@{spellpenetrationbonus}+`+
                    `(0?{Do you have any Spell penetration Bonuses?|0})]]}}`;
            }
            Macro = Macro + `{{Description=@{abilitydescriptiontext}}}`
            setAttrs({
                repeating_abilities_abilityroll: Macro
            });
        });
    });

    on("change:hd sheet:opened",function(){
        getAttrs(["HD","CloseRange","MediumRange","LongRange"],function(values){
            let HD = parseFloat(values.HD)||0;
            let Close = 25 + (Math.floor(HD/2)*5);
            let Medium = 100 + (HD*10);
            let Long = 400 + (HD*40);
            setAttrs({
                CloseRange: Close,
                MediumRange: Medium,
                LongRange: Long
            });
        }) ;
    });
    //</editor-fold>

    // <editor-fold desc="Attack Bonuses">

    on("change:repeating_weapons sheet:opened change:bab change:slow change:haste",function(){
        getAttrs(["BAB","slow","haste"],function(values){
            getSectionIDs("repeating_weapons",function(array){
                let rows = {};
                for (let arrayID of array){
                    rows['repeating_weapons_' + arrayID + `_weaponbab`] = values.BAB;
                    rows['repeating_weapons_' + arrayID + `_`+`weaponhaste`] = values.haste;
                    rows['repeating_weapons_' + arrayID + `_`+`weaponslow`] = values.slow;
                }
                if(rows){
                    setAttrs(rows);
                }
            });
        });
    });

    on("change:repeating_weapons:bonustoattack change:repeating_weapons:weaponhaste change:repeating_weapons:weaponslow" +
        "change:repeating_weapons:critlow change:repeating_weapons:weaponbab change:repeating_weapons:weaponminimize",
        function(){
            getAttrs(["repeating_weapons_bonustoattack","repeating_weapons_critlow","repeating_weapons_weaponhaste"
                ,"repeating_weapons_weaponbab","repeating_weapons_weaponslow"],function(values){
                let attackbonus = values.repeating_weapons_bonustoattack;
                let mincrit = parseFloat(values.repeating_weapons_critlow)||0;
                let BAB = parseFloat(values.repeating_weapons_weaponbab);
                let Macro = `&{template:custom}{{title=Attack(s)}}{{subtitle=@{charname}'s @{weaponname}}}`+
                    `{{First Attack=[[1d20cs>${mincrit}+${BAB}[Base Attack]+@{weapontohit}[Key Attribute]+${attackbonus}[Other Bonuses]+?(0?{`+
                    `Do you have any miscellaneous bonuses?|0})]]}}`;
                if(values.repeating_weapons_weaponhaste === "1"){
                    Macro = Macro + `{{Haste Attack=[[1d20cs>${mincrit}+${BAB}[Base Attack]+@{weapontohit}[Key Attribute]` +
                        `+${attackbonus}[Other Bonuses]+?(?{Do you have any miscellaneous bonuses?|0})]]}}`;
                }
                if(values.repeating_weapons_weaponslow === "0") {
                    if (BAB - 5 > 0) {
                        Macro = Macro + `{{Second Attack=[[1d20cs>${mincrit}+${BAB - 5}[Base Attack]+@{weapontohit}[Key Attribute]` +
                            `+${attackbonus}[Other Bonuses]+?(?{Do you have any miscellaneous bonuses?|0})]]}}`;
                    }
                    if (BAB - 10 > 0) {
                        Macro = Macro + `{{Third Attack=[[1d20cs>${mincrit}+${BAB - 10}[Base Attack]+@{weapontohit}[Key Attribute]` +
                            `+${attackbonus}[Other Bonuses]+?(?{Do you have any miscellaneous bonuses?|0})]]}}`;
                    }
                    if (BAB - 15 > 0) {
                        Macro = Macro + `{{Fourth Attack=[[1d20cs>${mincrit}+${BAB - 15}[Base Attack]+@{weapontohit}[Key Attribute]` +
                            `+${attackbonus}[Other Bonuses]+?(?{Do you have any miscellaneous bonuses?|0})]]}}`;
                    }
                }
                setAttrs({
                    repeating_weapons_fullattackroll: Macro
                });
            });
        });
    // </editor-fold>

</script>

<!--</editor-fold-->